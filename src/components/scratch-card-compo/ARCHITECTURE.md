# ğŸ—ï¸ Scratch Card System Architecture

## Component Hierarchy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Contest Platform                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                       â”‚
        â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create Contest    â”‚                  â”‚ Contest View     â”‚
â”‚ Page              â”‚                  â”‚ Page             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                       â”‚
        â”‚ Uses                                  â”‚ Uses
        â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ScratchCardEditor â”‚                  â”‚ ThreeScratchCard â”‚
â”‚                   â”‚                  â”‚                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Image Upload  â”‚ â”‚                  â”‚ â”‚ Three.js     â”‚ â”‚
â”‚ â”‚ Color Picker  â”‚ â”‚                  â”‚ â”‚ Scene        â”‚ â”‚
â”‚ â”‚ Sliders       â”‚ â”‚                  â”‚ â”‚              â”‚ â”‚
â”‚ â”‚ Toggles       â”‚ â”‚                  â”‚ â”‚ Canvas Mask  â”‚ â”‚
â”‚ â”‚ Dropdowns     â”‚ â”‚                  â”‚ â”‚              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                  â”‚ â”‚ Scratch      â”‚ â”‚
â”‚         â”‚         â”‚                  â”‚ â”‚ Detection    â”‚ â”‚
â”‚         â–¼         â”‚                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â”‚ Preview       â”‚ â”‚
â”‚ â”‚ Component     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

```
User Action
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ScratchCardEditor                   â”‚
â”‚ - User changes settings             â”‚
â”‚ - Updates config state              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ onChange(config)
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Parent Component (CreateContest)    â”‚
â”‚ - Stores config in state            â”‚
â”‚ - Saves to database on submit       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ Save to DB
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database                            â”‚
â”‚ - scratch_card_enabled: boolean     â”‚
â”‚ - scratch_card_config: JSON         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ Load contest
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ContestView Component               â”‚
â”‚ - Fetches contest data              â”‚
â”‚ - Passes config to scratch card     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ config prop
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ThreeScratchCard                    â”‚
â”‚ - Renders interactive card          â”‚
â”‚ - Handles scratch events            â”‚
â”‚ - Triggers callbacks                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Module Dependencies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ index.ts             â”‚  â† Main entry point
â”‚ (Exports all)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                     â”‚
          â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Components           â”‚              â”‚ Configuration        â”‚
â”‚                      â”‚              â”‚                      â”‚
â”‚ â€¢ ThreeScratchCard   â”‚              â”‚ â€¢ types.ts           â”‚
â”‚ â€¢ Preview            â”‚              â”‚ â€¢ scratchCardConfig  â”‚
â”‚ â€¢ Editor             â”‚              â”‚ â€¢ utils.ts           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ External Libraries   â”‚
              â”‚                      â”‚
              â”‚ â€¢ Three.js           â”‚
              â”‚ â€¢ React              â”‚
              â”‚ â€¢ Tailwind CSS       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Interaction Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ThreeScratchCard                          â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Three.js       â”‚         â”‚ Canvas Mask    â”‚             â”‚
â”‚  â”‚ Renderer       â”‚         â”‚ (Scratch Layer)â”‚             â”‚
â”‚  â”‚                â”‚         â”‚                â”‚             â”‚
â”‚  â”‚ â€¢ Scene        â”‚         â”‚ â€¢ 2D Context   â”‚             â”‚
â”‚  â”‚ â€¢ Camera       â”‚         â”‚ â€¢ Draw Lines   â”‚             â”‚
â”‚  â”‚ â€¢ Mesh         â”‚         â”‚ â€¢ Calculate %  â”‚             â”‚
â”‚  â”‚ â€¢ Lighting     â”‚         â”‚                â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                           â”‚                       â”‚
â”‚         â”‚                           â”‚                       â”‚
â”‚         â–¼                           â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚         Event Handlers                   â”‚              â”‚
â”‚  â”‚                                          â”‚              â”‚
â”‚  â”‚  â€¢ onMouseDown / onTouchStart           â”‚              â”‚
â”‚  â”‚  â€¢ onMouseMove / onTouchMove            â”‚              â”‚
â”‚  â”‚  â€¢ onMouseUp / onTouchEnd               â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                                                   â”‚
â”‚         â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚         State Management                 â”‚              â”‚
â”‚  â”‚                                          â”‚              â”‚
â”‚  â”‚  â€¢ isScratching                         â”‚              â”‚
â”‚  â”‚  â€¢ scratchedPercent                     â”‚              â”‚
â”‚  â”‚  â€¢ isRevealed                           â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                                                   â”‚
â”‚         â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚         Callbacks                        â”‚              â”‚
â”‚  â”‚                                          â”‚              â”‚
â”‚  â”‚  â€¢ onScratchProgress(percent)           â”‚              â”‚
â”‚  â”‚  â€¢ onReveal()                           â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## State Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Application State                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Contest Data â”‚   â”‚ Scratch Card â”‚   â”‚ UI State     â”‚
â”‚              â”‚   â”‚ Config       â”‚   â”‚              â”‚
â”‚ â€¢ id         â”‚   â”‚              â”‚   â”‚ â€¢ loading    â”‚
â”‚ â€¢ name       â”‚   â”‚ â€¢ prizeImage â”‚   â”‚ â€¢ error      â”‚
â”‚ â€¢ enabled    â”‚   â”‚ â€¢ coverColor â”‚   â”‚ â€¢ revealed   â”‚
â”‚ â€¢ config     â”‚   â”‚ â€¢ brushSize  â”‚   â”‚ â€¢ progress   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â€¢ threshold  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ â€¢ animations â”‚
                   â”‚ â€¢ effects    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Responsibilities

| File | Responsibility | Dependencies |
|------|---------------|--------------|
| **ThreeScratchCard.tsx** | Interactive scratch card rendering | Three.js, utils.ts, types.ts |
| **ThreeScratchCardPreview.tsx** | Lightweight preview display | types.ts |
| **ScratchCardEditor.tsx** | Configuration UI | Preview, types.ts, config.ts |
| **types.ts** | Type definitions | None |
| **scratchCardConfig.ts** | Default values & constants | types.ts |
| **utils.ts** | Helper functions | types.ts |
| **index.ts** | Public API exports | All components |
| **scratch-card.css** | Styles & animations | None |

## Rendering Pipeline

```
1. Component Mount
   â”‚
   â”œâ”€â†’ Initialize Three.js Scene
   â”‚   â”œâ”€â†’ Create Camera
   â”‚   â”œâ”€â†’ Create Renderer
   â”‚   â”œâ”€â†’ Load Prize Texture
   â”‚   â”œâ”€â†’ Create Mesh with Material
   â”‚   â””â”€â†’ Add Lighting
   â”‚
   â”œâ”€â†’ Initialize Scratch Canvas
   â”‚   â”œâ”€â†’ Set Canvas Dimensions
   â”‚   â”œâ”€â†’ Fill with Cover Color
   â”‚   â””â”€â†’ Overlay Cover Image (if any)
   â”‚
   â””â”€â†’ Start Animation Loop
       â””â”€â†’ Render Scene (60 FPS)

2. User Interaction
   â”‚
   â”œâ”€â†’ Touch/Mouse Down
   â”‚   â””â”€â†’ Set isScratching = true
   â”‚
   â”œâ”€â†’ Touch/Mouse Move
   â”‚   â”œâ”€â†’ Get Canvas Position
   â”‚   â”œâ”€â†’ Draw Scratch Line
   â”‚   â”œâ”€â†’ Calculate Percentage
   â”‚   â”œâ”€â†’ Update State
   â”‚   â””â”€â†’ Check Threshold
   â”‚
   â””â”€â†’ Touch/Mouse Up
       â””â”€â†’ Set isScratching = false

3. Reveal Trigger
   â”‚
   â”œâ”€â†’ Clear Scratch Canvas
   â”œâ”€â†’ Trigger Animation
   â”œâ”€â†’ Trigger Effect
   â”œâ”€â†’ Call onReveal()
   â””â”€â†’ Update UI
```

## Performance Optimization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Optimization Layers                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rendering    â”‚   â”‚ Event        â”‚   â”‚ Memory       â”‚
â”‚              â”‚   â”‚ Handling     â”‚   â”‚ Management   â”‚
â”‚ â€¢ RAF loop   â”‚   â”‚              â”‚   â”‚              â”‚
â”‚ â€¢ Conditionalâ”‚   â”‚ â€¢ Debounce   â”‚   â”‚ â€¢ Cleanup    â”‚
â”‚   updates    â”‚   â”‚ â€¢ Throttle   â”‚   â”‚ â€¢ Dispose    â”‚
â”‚ â€¢ GPU accel  â”‚   â”‚ â€¢ Passive    â”‚   â”‚ â€¢ GC hints   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Error Handling

```
Try/Catch Boundaries
    â”‚
    â”œâ”€â†’ Image Loading
    â”‚   â”œâ”€â†’ Fallback to placeholder
    â”‚   â””â”€â†’ Log error
    â”‚
    â”œâ”€â†’ Three.js Initialization
    â”‚   â”œâ”€â†’ Check WebGL support
    â”‚   â””â”€â†’ Graceful degradation
    â”‚
    â””â”€â†’ Canvas Operations
        â”œâ”€â†’ Validate context
        â””â”€â†’ Safe defaults
```

## Extension Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Customization Hooks                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Callbacks    â”‚   â”‚ Config       â”‚   â”‚ Styling      â”‚
â”‚              â”‚   â”‚              â”‚   â”‚              â”‚
â”‚ â€¢ onReveal   â”‚   â”‚ â€¢ Colors     â”‚   â”‚ â€¢ CSS vars   â”‚
â”‚ â€¢ onProgress â”‚   â”‚ â€¢ Sizes      â”‚   â”‚ â€¢ Tailwind   â”‚
â”‚ â€¢ onReset    â”‚   â”‚ â€¢ Thresholds â”‚   â”‚ â€¢ Classes    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Testing Strategy

```
Unit Tests
    â”‚
    â”œâ”€â†’ Utils Functions
    â”‚   â”œâ”€â†’ calculateScratchPercentage()
    â”‚   â”œâ”€â†’ drawScratchLine()
    â”‚   â””â”€â†’ getCanvasPoint()
    â”‚
    â”œâ”€â†’ Config Validation
    â”‚   â””â”€â†’ DEFAULT_SCRATCH_CARD_CONFIG
    â”‚
    â””â”€â†’ Type Checking
        â””â”€â†’ ScratchCardOptions

Integration Tests
    â”‚
    â”œâ”€â†’ Component Rendering
    â”œâ”€â†’ User Interactions
    â””â”€â†’ State Updates

E2E Tests
    â”‚
    â”œâ”€â†’ Full Scratch Flow
    â”œâ”€â†’ Mobile Touch Events
    â””â”€â†’ Reveal Animations
```

## Deployment Checklist

- [ ] Install dependencies (`npm install three @types/three`)
- [ ] Import CSS styles
- [ ] Update database schema
- [ ] Add to contest form
- [ ] Add to contest view
- [ ] Test on desktop
- [ ] Test on mobile
- [ ] Test animations
- [ ] Test callbacks
- [ ] Optimize images
- [ ] Configure CDN (optional)
- [ ] Enable gzip compression
- [ ] Monitor performance
- [ ] Set up analytics
- [ ] Deploy to production

---

**Architecture designed for scalability, maintainability, and performance.**
